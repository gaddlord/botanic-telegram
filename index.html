<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Botanical Telegram - Floriography Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-serif: 'Libre Baskerville', serif;
            --font-sans: 'Inter', sans-serif;
        }
        body { font-family: var(--font-serif); }
        .font-sans { font-family: var(--font-sans); }
        .flower-inverted { transform: rotate(180deg); }
        .flower-left { transform: rotate(-45deg); }
        .flower-right { transform: rotate(45deg); }
        .flower-upright { transform: rotate(0deg); }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        
        .emotion-wheel-item {
            position: absolute;
            transform-origin: center;
            transition: all 0.3s ease;
        }
        
        .emotion-wheel-item:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        @media (max-width: 768px) {
            #emotion-wheel-container {
                width: 280px !important;
                height: 280px !important;
            }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-900 selection:bg-rose-100 overflow-x-hidden">

    <!-- Main Application -->
    <div id="main-application">

    <!-- Emotion Wheel Modal -->
    <div id="modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-stone-950/95 p-4 transition-opacity duration-300">
        <button onclick="toggleModal()" class="absolute top-4 right-4 z-[110] p-4 bg-white/10 hover:bg-white/20 text-white rounded-full transition-all hover:rotate-90">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        <div class="w-full h-full overflow-auto flex items-center justify-center p-4">
            <img src="https://www.visualcapitalist.com/wp-content/uploads/2021/04/guide-to-emotions-motion-wheel.jpg" alt="Emotion Wheel" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
        </div>
    </div>

    <!-- Header -->
    <header class="px-8 py-24 text-center bg-white border-b border-stone-200 relative">
        <div class="absolute inset-0 bg-cover bg-center opacity-20" style="background-image: url('background.jpg');"></div>
        <!-- Language Selector -->
        <div class="absolute top-4 right-4 z-20">
            <select id="language-selector" onchange="changeLanguage(this.value)" class="px-4 py-2 bg-white border border-stone-300 rounded-full text-sm font-sans font-bold text-stone-800 hover:bg-stone-50 transition-all cursor-pointer">
                <option value="EN">EN</option>
                <option value="ES">ES</option>
                <option value="GE">GE</option>
                <option value="FR">FR</option>
                <option value="PL">PL</option>
                <option value="HI">HI</option>
                <option value="BN">BN</option>
                <option value="MR">MR</option>
                <option value="TE">TE</option>
            </select>
        </div>
        <div class="max-w-4xl mx-auto relative z-10">
            <div class="flex justify-center mb-8">
                <div class="p-6 bg-rose-50 rounded-full animate-float">
                    <svg class="text-rose-500" width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5 4.5 4.5 0 1 1 16.5 12 4.5 4.5 0 1 1 12 16.5"></path><path d="M12 7.5V2"></path><path d="M12 22v-5.5"></path><path d="m16.5 12 5.5.01"></path><path d="M2 12h5.5"></path><path d="m15.2 8.8 3.9-3.9"></path><path d="m4.9 19.1 3.9-3.9"></path><path d="m15.2 15.2 3.9 3.9"></path><path d="m4.9 4.9 3.9 3.9"></path></svg>
                </div>
            </div>
            <h1 class="text-6xl md:text-8xl font-bold text-stone-800 mb-6 tracking-tighter" data-i18n="title">The Botanical Telegram</h1>
            <p class="text-stone-500 max-w-2xl mx-auto italic text-xl md:text-2xl leading-relaxed font-sans" data-i18n="subtitle">
                "By the simple language of flowers, the most delicate and refined sentiments may be expressed."
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main id="workspace" class="max-w-[1400px] mx-auto p-6 md:p-12 lg:grid lg:grid-cols-12 lg:gap-20 pt-32">
        
        <!-- Controls -->
        <div class="lg:col-span-5 space-y-16">
            <section>
                <div class="flex items-center gap-6 mb-10">
                    <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 font-bold font-sans">1</div>
                    <h2 class="text-3xl font-bold text-stone-800" data-i18n="identifySentiment">Identify Sentiment</h2>
                </div>
                <div id="emotion-categories" class="relative w-full h-96 mb-8 flex items-center justify-center">
                    <div class="relative w-80 h-80 mx-auto" id="emotion-wheel-container"></div>
                </div>
                <div id="sub-emotions" class="hidden bg-white p-8 rounded-3xl border border-stone-200 shadow-sm animate-in fade-in relative">
                    <p class="text-[11px] uppercase tracking-[0.3em] text-stone-400 mb-8 font-black font-sans" data-i18n="selectVictorian">Select Victorian Specifics</p>
                    <div id="sub-emotion-list" class="flex flex-wrap gap-4"></div>
                    <div id="flower-preview" class="hidden absolute z-50 bg-white rounded-2xl shadow-2xl border border-stone-200 p-6 pointer-events-none transition-all duration-200" style="min-width: 200px;">
                        <div class="w-32 h-32 rounded-xl overflow-hidden mb-3 border-2 border-stone-100">
                            <img id="preview-image" src="" alt="" class="w-full h-full object-cover">
                        </div>
                        <p id="preview-name" class="text-sm font-bold text-stone-800 mb-1"></p>
                        <p id="preview-meaning" class="text-xs text-stone-500 italic"></p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Preview -->
        <div class="lg:col-span-7 mt-20 lg:mt-0 space-y-12">
            <div class="bg-stone-950 rounded-[5rem] min-h-[700px] flex flex-col p-12 overflow-hidden shadow-4xl relative">
                <!-- Visual Background -->
                <div class="absolute inset-0 pointer-events-none opacity-30">
                    <div class="absolute top-0 left-0 w-[600px] h-[600px] bg-emerald-500 rounded-full blur-[140px] -translate-x-1/2 -translate-y-1/2"></div>
                    <div class="absolute bottom-0 right-0 w-[600px] h-[600px] bg-rose-500 rounded-full blur-[140px] translate-x-1/2 translate-y-1/2"></div>
                </div>

                <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-center space-y-10 relative z-10">
                    <div class="w-40 h-40 bg-white/5 rounded-full flex items-center justify-center border border-white/10">
                        <svg class="text-stone-800" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"></circle><path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5 4.5 4.5 0 1 1 16.5 12 4.5 4.5 0 1 1 12 16.5"></path></svg>
                    </div>
                    <div class="space-y-6">
                        <h3 class="text-4xl font-bold text-stone-200 tracking-tight" data-i18n="composeMessage">Compose Your Message</h3>
                        <p class="text-stone-500 italic max-w-sm text-lg font-sans" data-i18n="selectEmotions">Select emotions to grow your botanical arrangement.</p>
                    </div>
                </div>

                <div id="active-state" class="hidden flex-1 flex flex-col relative z-10">
                    <div id="floral-field" class="flex-1 flex flex-wrap justify-center items-center content-center gap-16 py-16"></div>
                    
                    <div class="bg-white/5 backdrop-blur-3xl p-12 rounded-[3rem] border border-white/15 shadow-2xl space-y-10 mt-auto">
                        <div class="flex items-center justify-between">
                            <h3 class="text-rose-100 font-bold text-sm uppercase tracking-[0.4em] font-sans" data-i18n="synthesis">Synthesis</h3>
                            <div id="mode-badge" class="px-6 py-2 rounded-full bg-white/10 text-[11px] font-black uppercase tracking-[0.2em] text-stone-400 font-sans border border-white/10">Mode: Upright</div>
                        </div>
                        <p id="synthesis-text" class="text-4xl md:text-5xl font-semibold leading-tight text-stone-50 tracking-tight"></p>
                    </div>
                    
                    <div class="mt-8 space-y-6">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center text-amber-300 font-bold font-sans text-sm">2</div>
                            <h2 class="text-2xl font-bold text-stone-200" data-i18n="presentationModality">Presentation Modality</h2>
                        </div>
                        <div class="grid grid-cols-2 gap-4" id="modality-controls"></div>
                    </div>
                </div>
            </div>

            <div id="dictionary-entries" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
        </div>
    </main>

    <footer class="max-w-[1400px] mx-auto p-16 mt-20 border-t border-stone-200 text-stone-400 flex flex-col md:flex-row justify-between items-center gap-10">
        <div class="flex items-center gap-6 font-sans uppercase tracking-[0.3em] font-bold text-xs">
            <span data-i18n="established">Established 1884</span>
        </div>
        <div class="text-center md:text-right font-sans opacity-70 max-w-md italic">
            <span data-i18n="historicalSource">Historical floriography sourced from the archives of Routledge & Sons.</span>
        </div>
        <div class="flex gap-4">
            <a href="dictionary.html" class="px-8 py-4 bg-stone-900 text-stone-50 rounded-full hover:bg-stone-800 transition-all font-sans font-bold uppercase tracking-widest text-sm">
                <span data-i18n="dictionary">Dictionary</span>
            </a>
        </div>
    </footer>

    </div>
    <!-- End Main Application -->

    <script>
        // Translation system
        let currentLanguage = localStorage.getItem('language') || 'EN';
        
        const translations = {
            EN: {
                title: "The Botanical Telegram",
                subtitle: "\"By the simple language of flowers, the most delicate and refined sentiments may be expressed.\"",
                identifySentiment: "Identify Sentiment",
                selectVictorian: "Select Victorian Specifics",
                composeMessage: "Compose Your Message",
                selectEmotions: "Select emotions to grow your botanical arrangement.",
                synthesis: "Synthesis",
                presentationModality: "Presentation Modality",
                established: "Established 1884",
                historicalSource: "Historical floriography sourced from the archives of Routledge & Sons.",
                dictionary: "Dictionary",
                mode: "Mode",
                upright: "Upright",
                inverted: "Inverted",
                left: "To Heart",
                right: "Extend",
                classicMeaning: "Classic Meaning",
                oppositeSpirit: "Opposite Spirit",
                fromGiver: "From Giver",
                toReceiver: "To Receiver",
                bouquetOf: "A bouquet of",
                stem: "stem",
                stems: "stems",
                signifying: "signifying",
                meaning: "Meaning",
                opposite: "Opposite",
                consult: "Consult",
                joy: "Joy",
                love: "Love",
                sadness: "Sadness",
                anger: "Anger",
                fear: "Fear",
                surprise: "Surprise"
            },
            ES: {
                title: "El Telegrama Botánico",
                subtitle: "\"Por el simple lenguaje de las flores, los sentimientos más delicados y refinados pueden expresarse.\"",
                identifySentiment: "Identificar Sentimiento",
                selectVictorian: "Seleccionar Específicos Victorianos",
                composeMessage: "Componer Tu Mensaje",
                selectEmotions: "Selecciona emociones para hacer crecer tu arreglo botánico.",
                synthesis: "Síntesis",
                presentationModality: "Modalidad de Presentación",
                established: "Establecido 1884",
                historicalSource: "Floriografía histórica obtenida de los archivos de Routledge & Sons.",
                dictionary: "Diccionario",
                mode: "Modo",
                upright: "Vertical",
                inverted: "Invertido",
                left: "Al Corazón",
                right: "Extender",
                classicMeaning: "Significado Clásico",
                oppositeSpirit: "Espíritu Opuesto",
                fromGiver: "Del Dador",
                toReceiver: "Al Receptor",
                bouquetOf: "Un ramo de",
                stem: "tallo",
                stems: "tallos",
                signifying: "significando",
                meaning: "Significado",
                opposite: "Opuesto",
                consult: "Consultar",
                joy: "Alegría",
                love: "Amor",
                sadness: "Tristeza",
                anger: "Ira",
                fear: "Miedo",
                surprise: "Sorpresa"
            },
            GE: {
                title: "Das Botanische Telegramm",
                subtitle: "\"Durch die einfache Sprache der Blumen können die zartesten und raffiniertesten Gefühle ausgedrückt werden.\"",
                identifySentiment: "Gefühl Identifizieren",
                selectVictorian: "Viktorianische Besonderheiten Auswählen",
                composeMessage: "Verfasse Deine Nachricht",
                selectEmotions: "Wähle Emotionen, um dein botanisches Arrangement wachsen zu lassen.",
                synthesis: "Synthese",
                presentationModality: "Präsentationsmodalität",
                established: "Gegründet 1884",
                historicalSource: "Historische Blumensprache aus den Archiven von Routledge & Sons.",
                dictionary: "Wörterbuch",
                mode: "Modus",
                upright: "Aufrecht",
                inverted: "Invertiert",
                left: "Zum Herzen",
                right: "Erweitern",
                classicMeaning: "Klassische Bedeutung",
                oppositeSpirit: "Gegensätzlicher Geist",
                fromGiver: "Vom Geber",
                toReceiver: "Zum Empfänger",
                bouquetOf: "Ein Strauß aus",
                stem: "Stiel",
                stems: "Stielen",
                signifying: "bedeutend",
                meaning: "Bedeutung",
                opposite: "Gegenteil",
                consult: "Konsultieren",
                joy: "Freude",
                love: "Liebe",
                sadness: "Traurigkeit",
                anger: "Wut",
                fear: "Angst",
                surprise: "Überraschung"
            },
            FR: {
                title: "Le Télégramme Botanique",
                subtitle: "\"Par le simple langage des fleurs, les sentiments les plus délicats et raffinés peuvent être exprimés.\"",
                identifySentiment: "Identifier le Sentiment",
                selectVictorian: "Sélectionner les Spécificités Victoriennes",
                composeMessage: "Composez Votre Message",
                selectEmotions: "Sélectionnez des émotions pour faire grandir votre arrangement botanique.",
                synthesis: "Synthèse",
                presentationModality: "Modalité de Présentation",
                established: "Établi 1884",
                historicalSource: "Floriographie historique provenant des archives de Routledge & Sons.",
                dictionary: "Dictionnaire",
                mode: "Mode",
                upright: "Droit",
                inverted: "Inversé",
                left: "Au Cœur",
                right: "Étendre",
                classicMeaning: "Signification Classique",
                oppositeSpirit: "Esprit Opposé",
                fromGiver: "Du Donneur",
                toReceiver: "Au Destinataire",
                bouquetOf: "Un bouquet de",
                stem: "tige",
                stems: "tiges",
                signifying: "signifiant",
                meaning: "Signification",
                opposite: "Opposé",
                consult: "Consulter",
                joy: "Joie",
                love: "Amour",
                sadness: "Tristesse",
                anger: "Colère",
                fear: "Peur",
                surprise: "Surprise"
            },
            PL: {
                title: "Botaniczny Telegram",
                subtitle: "\"Przez prosty język kwiatów można wyrazić najdelikatniejsze i najbardziej wyrafinowane uczucia.\"",
                identifySentiment: "Zidentyfikuj Uczucie",
                selectVictorian: "Wybierz Szczegóły Wiktoriańskie",
                composeMessage: "Skomponuj Swoją Wiadomość",
                selectEmotions: "Wybierz emocje, aby rozwinąć swój botaniczny układ.",
                synthesis: "Synteza",
                presentationModality: "Modalność Prezentacji",
                established: "Założone 1884",
                historicalSource: "Historyczna floriografia pochodząca z archiwów Routledge & Sons.",
                dictionary: "Słownik",
                mode: "Tryb",
                upright: "Pionowy",
                inverted: "Odwrócony",
                left: "Do Serca",
                right: "Rozszerz",
                classicMeaning: "Klasyczne Znaczenie",
                oppositeSpirit: "Przeciwny Duch",
                fromGiver: "Od Dawcy",
                toReceiver: "Do Odbiorcy",
                bouquetOf: "Bukiet z",
                stem: "łodyga",
                stems: "łodyg",
                signifying: "oznaczający",
                meaning: "Znaczenie",
                opposite: "Przeciwieństwo",
                consult: "Konsultuj",
                joy: "Radość",
                love: "Miłość",
                sadness: "Smutek",
                anger: "Gniew",
                fear: "Strach",
                surprise: "Niespodzianka"
            },
            HI: {
                title: "वनस्पति टेलीग्राम",
                subtitle: "\"फूलों की सरल भाषा से, सबसे नाजुक और परिष्कृत भावनाओं को व्यक्त किया जा सकता है।\"",
                identifySentiment: "भावना की पहचान करें",
                selectVictorian: "विक्टोरियन विशिष्टताएं चुनें",
                composeMessage: "अपना संदेश लिखें",
                selectEmotions: "अपनी वनस्पति व्यवस्था बढ़ाने के लिए भावनाएं चुनें।",
                synthesis: "संश्लेषण",
                presentationModality: "प्रस्तुति मोड",
                established: "स्थापित 1884",
                historicalSource: "रूटलेज एंड संस के अभिलेखागार से ऐतिहासिक फ्लोरियोग्राफी।",
                dictionary: "शब्दकोश",
                mode: "मोड",
                upright: "सीधा",
                inverted: "उल्टा",
                left: "दिल की ओर",
                right: "विस्तार",
                classicMeaning: "क्लासिक अर्थ",
                oppositeSpirit: "विपरीत भावना",
                fromGiver: "दाता से",
                toReceiver: "प्राप्तकर्ता को",
                bouquetOf: "का गुलदस्ता",
                stem: "तना",
                stems: "तने",
                signifying: "दर्शाता",
                meaning: "अर्थ",
                opposite: "विपरीत",
                consult: "परामर्श",
                joy: "खुशी",
                love: "प्यार",
                sadness: "उदासी",
                anger: "क्रोध",
                fear: "डर",
                surprise: "आश्चर्य"
            },
            BN: {
                title: "বোটানিক্যাল টেলিগ্রাম",
                subtitle: "\"ফুলের সরল ভাষার মাধ্যমে, সবচেয়ে সূক্ষ্ম এবং পরিশীলিত অনুভূতি প্রকাশ করা যেতে পারে।\"",
                identifySentiment: "অনুভূতি চিহ্নিত করুন",
                selectVictorian: "ভিক্টোরিয়ান নির্দিষ্টতা নির্বাচন করুন",
                composeMessage: "আপনার বার্তা রচনা করুন",
                selectEmotions: "আপনার উদ্ভিদ ব্যবস্থা বাড়াতে আবেগ নির্বাচন করুন।",
                synthesis: "সংশ্লেষণ",
                presentationModality: "উপস্থাপনা মোড",
                established: "প্রতিষ্ঠিত ১৮৮৪",
                historicalSource: "রাউটলেজ অ্যান্ড সন্সের আর্কাইভ থেকে ঐতিহাসিক ফ্লোরিওগ্রাফি।",
                dictionary: "অভিধান",
                mode: "মোড",
                upright: "সোজা",
                inverted: "উল্টানো",
                left: "হৃদয়ের দিকে",
                right: "প্রসারিত",
                classicMeaning: "শাস্ত্রীয় অর্থ",
                oppositeSpirit: "বিপরীত আত্মা",
                fromGiver: "দাতা থেকে",
                toReceiver: "গ্রহীতা কাছে",
                bouquetOf: "এর তোড়া",
                stem: "কাণ্ড",
                stems: "কাণ্ড",
                signifying: "বোঝায়",
                meaning: "অর্থ",
                opposite: "বিপরীত",
                consult: "পরামর্শ",
                joy: "আনন্দ",
                love: "ভালবাসা",
                sadness: "দুঃখ",
                anger: "ক্রোধ",
                fear: "ভয়",
                surprise: "আশ্চর্য"
            },
            MR: {
                title: "वनस्पती टेलीग्राम",
                subtitle: "\"फुलांच्या सोप्या भाषेने, सर्वात नाजूक आणि परिष्कृत भावना व्यक्त केल्या जाऊ शकतात.\"",
                identifySentiment: "भावना ओळखा",
                selectVictorian: "विक्टोरियन विशिष्टता निवडा",
                composeMessage: "आपले संदेश तयार करा",
                selectEmotions: "आपली वनस्पती व्यवस्था वाढवण्यासाठी भावना निवडा.",
                synthesis: "संश्लेषण",
                presentationModality: "प्रस्तुती मोड",
                established: "स्थापित १८८४",
                historicalSource: "रूटलेज अँड सन्सच्या आर्काइव्हमधून ऐतिहासिक फ्लोरियोग्राफी.",
                dictionary: "शब्दकोश",
                mode: "मोड",
                upright: "सरळ",
                inverted: "उलटे",
                left: "हृदयाकडे",
                right: "विस्तार",
                classicMeaning: "क्लासिक अर्थ",
                oppositeSpirit: "विरुद्ध भावना",
                fromGiver: "दात्याकडून",
                toReceiver: "प्राप्तकर्त्याकडे",
                bouquetOf: "चा गुलदस्ता",
                stem: "खोड",
                stems: "खोड",
                signifying: "दर्शवित",
                meaning: "अर्थ",
                opposite: "विरुद्ध",
                consult: "सल्ला",
                joy: "आनंद",
                love: "प्रेम",
                sadness: "दुःख",
                anger: "राग",
                fear: "भीती",
                surprise: "आश्चर्य"
            },
            TE: {
                title: "వృక్షశాస్త్ర టెలిగ్రామ్",
                subtitle: "\"పువ్వుల సాధారణ భాష ద్వారా, అత్యంత సున్నితమైన మరియు శుద్ధమైన భావోద్వేగాలను వ్యక్తీకరించవచ్చు.\"",
                identifySentiment: "భావోద్వేగాన్ని గుర్తించండి",
                selectVictorian: "విక్టోరియన్ నిర్దిష్టతలను ఎంచుకోండి",
                composeMessage: "మీ సందేశాన్ని కంపోజ్ చేయండి",
                selectEmotions: "మీ వృక్షశాస్త్ర అమరికను పెంచడానికి భావోద్వేగాలను ఎంచుకోండి.",
                synthesis: "సంశ్లేషణ",
                presentationModality: "ప్రెజెంటేషన్ మోడ్",
                established: "స్థాపించబడింది 1884",
                historicalSource: "రౌట్లెడ్జ్ & సన్స్ ఆర్కైవ్‌ల నుండి చారిత్రక ఫ్లోరియోగ్రఫీ.",
                dictionary: "నిఘంటువు",
                mode: "మోడ్",
                upright: "నిటారుగా",
                inverted: "వ్యతిరేకం",
                left: "హృదయానికి",
                right: "విస్తరించు",
                classicMeaning: "క్లాసిక్ అర్థం",
                oppositeSpirit: "వ్యతిరేక ఆత్మ",
                fromGiver: "దాత నుండి",
                toReceiver: "స్వీకర్తకు",
                bouquetOf: "పూలగుత్తి",
                stem: "కాండం",
                stems: "కాండాలు",
                signifying: "సూచిస్తుంది",
                meaning: "అర్థం",
                opposite: "వ్యతిరేకం",
                consult: "సలహా",
                joy: "సంతోషం",
                love: "ప్రేమ",
                sadness: "విచారం",
                anger: "కోపం",
                fear: "భయం",
                surprise: "ఆశ్చర్యం"
            }
        };

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            updateTranslations();
            // Re-render dynamic content
            if (typeof renderCategories === 'function') renderCategories();
            if (typeof renderModality === 'function') renderModality();
            if (typeof updateBouquet === 'function') updateBouquet();
        }

        function updateTranslations() {
            const t = translations[currentLanguage];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.value = t[key];
                    } else {
                        el.textContent = t[key];
                    }
                }
            });
            // Update language selector
            const selector = document.getElementById('language-selector');
            if (selector) selector.value = currentLanguage;
        }

        function t(key) {
            return translations[currentLanguage][key] || translations.EN[key] || key;
        }

        const FLORAL_DICTIONARY = {
            "Joyful": { name: "Lily of the Valley", meaning: "Return of Happiness", opposite: "Lingering Sadness", color: "#F8FAFC", image: "flower/lily-of-the-valley.jpg" },
            "Content": { name: "Daisy", meaning: "Innocence and Loyal Love", opposite: "Disillusionment", color: "#FEF9C3", image: "flower/daisy.jpg" },
            "Innocence": { name: "Daisy", meaning: "Innocence", opposite: "Corruption", color: "#FEF9C3", image: "flower/daisy.jpg" },
            "Optimistic": { name: "Flowering Almond", meaning: "Hope", opposite: "Despair", color: "#FCE7F3", image: "flower/flowering-almond.jpg" },
            "Hope": { name: "Snowdrop", meaning: "Hope", opposite: "Despair", color: "#F8FAFC", image: "flower/snowdrop.jpg" },
            "Peaceful": { name: "Crocus", meaning: "Youthful Gladness", opposite: "Melancholy", color: "#EDE9FE", image: "flower/crocus.jpg" },
            "Gladness": { name: "Crocus", meaning: "Gladness", opposite: "Melancholy", color: "#EDE9FE", image: "flower/crocus.jpg" },
            "Purity": { name: "Lily (White)", meaning: "Purity", opposite: "Corruption", color: "#F8FAFC", image: "flower/lily-white.jpg" },
            "Friendship": { name: "Ivy", meaning: "Friendship", opposite: "Enmity", color: "#059669", image: "flower/ivy.jpg" },
            "Elegance": { name: "Acacia Rose", meaning: "Elegance", opposite: "Vulgarity", color: "#EC4899", image: "flower/acacia-rose.jpg" },
            "Temperance": { name: "Azalea", meaning: "Temperance", opposite: "Excess", color: "#EC4899", image: "flower/azalea.jpg" },
            "Constancy": { name: "Bluebell", meaning: "Constancy", opposite: "Inconstancy", color: "#3B82F6", image: "flower/bluebell.jpg" },
            "Fidelity": { name: "Wallflower", meaning: "Fidelity in adversity", opposite: "Infidelity", color: "#F59E0B", image: "flower/wallflower.jpg" },
            "Mental beauty": { name: "Clematis", meaning: "Mental Beauty", opposite: "Superficiality", color: "#A855F7", image: "flower/clematis.jpg" },
            "Preference": { name: "Apple Blossom", meaning: "Preference", opposite: "Indifference", color: "#FCE7F3", image: "flower/apple-blossom.jpg" },
            "Amiability": { name: "Jasmine (White)", meaning: "Amiability", opposite: "Hostility", color: "#F8FAFC", image: "flower/jasmine-white.jpg" },
            "Humility": { name: "Bluebell", meaning: "Humility", opposite: "Arrogance", color: "#3B82F6", image: "flower/bluebell.jpg" },
            "Incorruptible": { name: "Cedar of Lebanon", meaning: "Incorruptible", opposite: "Corruption", color: "#064E3B", image: "flower/cedar-of-lebanon.jpg" },
            "Truth": { name: "Bittersweet", meaning: "Truth", opposite: "Falsehood", color: "#F97316", image: "flower/bittersweet.jpg" },
            "Loveliness": { name: "Camellia (White)", meaning: "Loveliness", opposite: "Ugliness", color: "#F8FAFC", image: "flower/camellia-white.jpg" },
            "Acknowledgment": { name: "Canterbury Bell", meaning: "Acknowledgment", opposite: "Ignorance", color: "#A855F7", image: "flower/canterbury-bell.jpg" },
            "Constant": { name: "Hyacinth (Blue)", meaning: "Constancy", opposite: "Inconstancy", color: "#3B82F6", image: "flower/hyacinth-blue.jpg" },
            "I am worthy": { name: "Rose (White)", meaning: "I am worthy of you", opposite: "Unworthiness", color: "#F8FAFC", image: "flower/white-rose.jpg" },
            "Celibacy": { name: "Bachelor's Button", meaning: "Celibacy", opposite: "Marriage", color: "#3B82F6", image: "flower/bachelors-button.jpg" },
            "Steadfast piety": { name: "Geranium (Wild)", meaning: "Steadfast Piety", opposite: "Irreverence", color: "#EC4899", image: "flower/geranium-wild.jpg" },
            "Neatness": { name: "Broom", meaning: "Neatness", opposite: "Disorder", color: "#FEF08A", image: "flower/broom.jpg" },
            "Modesty": { name: "Violet (White)", meaning: "Modesty", opposite: "Immodesty", color: "#F8FAFC", image: "flower/violet-white.jpg" },
            "Youthfulness": { name: "Primrose", meaning: "Youthfulness", opposite: "Maturity", color: "#FEF08A", image: "flower/primrose.jpg" },
            "Sweetness": { name: "Lily (White)", meaning: "Sweetness", opposite: "Bitterness", color: "#F8FAFC", image: "flower/lily-white.jpg" },
            "Candor": { name: "Violet (White)", meaning: "Candor", opposite: "Deceit", color: "#F8FAFC", image: "flower/violet-white.jpg" },
            "Childishness": { name: "Buttercup", meaning: "Childishness", opposite: "Maturity", color: "#FEF08A", image: "flower/buttercup.jpg" },
            "Playful": { name: "Yellow Rose", meaning: "Decrease of Love", opposite: "Deepening Affection", color: "#FEF08A", image: "flower/yellow-rose.jpg" },
            "Powerful": { name: "Cypress", meaning: "Strength in Sorrow", opposite: "Fragility", color: "#064E3B", image: "flower/cypress.jpg" },
            "Triumphant": { name: "Bay Leaf", meaning: "I change but in death", opposite: "Fickleness", color: "#14532D", image: "flower/bay-leaf.jpg" },
            "Proud": { name: "Amaryllis", meaning: "Splendid Beauty / Pride", opposite: "Humility", color: "#EF4444", image: "flower/amaryllis.jpg" },
            "Enchanted": { name: "Fern", meaning: "Fascination / Magic", opposite: "Boredom", color: "#059669", image: "flower/fern.jpg" },
            "Sentimental": { name: "Purple Lilac", meaning: "First Emotions of Love", opposite: "Indifference", color: "#C084FC", image: "flower/purple-lilac.jpg" },
            "Compassionate": { name: "Balm", meaning: "Sympathy", opposite: "Callousness", color: "#818CF8", image: "flower/balm.jpg" },
            "Grateful": { name: "Bellflower", meaning: "Gratitude", opposite: "Ingratitude", color: "#6366F1", image: "flower/bellflower.jpg" },
            "Deep": { name: "Red Rose", meaning: "Deep Love", opposite: "Animosity", color: "#991B1B", image: "flower/red-rose.jpg" },
            "Returned": { name: "Ambrosia", meaning: "Love Returned", opposite: "Unrequited Love", color: "#F59E0B", image: "flower/ambrosia.jpg" },
            "Loyal": { name: "Daisy", meaning: "Loyal Love", opposite: "Disloyalty", color: "#FEF9C3", image: "flower/daisy.jpg" },
            "Passionate": { name: "Red Rose", meaning: "Passionate Love", opposite: "Indifference", color: "#991B1B", image: "flower/red-rose.jpg" },
            "Secret": { name: "Yellow Acacia", meaning: "Secret Love", opposite: "Open Affection", color: "#EAB308", image: "flower/yellow-acacia.jpg" },
            "Affection": { name: "Gillyflower", meaning: "Affection", opposite: "Indifference", color: "#EC4899", image: "flower/gillyflower.jpg" },
            "Generous": { name: "Honeysuckle", meaning: "Generous Affection", opposite: "Selfishness", color: "#F59E0B", image: "flower/honeysuckle.jpg" },
            "Devoted": { name: "Honeysuckle", meaning: "Devoted Affection", opposite: "Indifference", color: "#F59E0B", image: "flower/honeysuckle.jpg" },
            "Faithfulness": { name: "Heliotrope", meaning: "Faithfulness", opposite: "Infidelity", color: "#A855F7", image: "flower/heliotrope.jpg" },
            "True": { name: "Forget-Me-Not", meaning: "True Love", opposite: "False Love", color: "#3B82F6", image: "flower/forget-me-not.jpg" },
            "Don't forget me": { name: "Forget-Me-Not", meaning: "Don't forget me", opposite: "Forgetfulness", color: "#3B82F6", image: "flower/forget-me-not.jpg" },
            "Slighted": { name: "Chrysanthemum (Yellow)", meaning: "Slighted Love", opposite: "Esteemed Love", color: "#EAB308", image: "flower/chrysanthemum-yellow.jpg" },
            "I love": { name: "Chrysanthemum (Red)", meaning: "I love", opposite: "I don't love", color: "#EF4444", image: "flower/chrysanthemum-red.jpg" },
            "Unequalled": { name: "Daffodil", meaning: "Unequalled Love", opposite: "Common Love", color: "#FEF08A", image: "flower/daffodil.jpg" },
            "First": { name: "Purple Lilac", meaning: "First Love", opposite: "Last Love", color: "#C084FC", image: "flower/purple-lilac.jpg" },
            "Decreased": { name: "Yellow Rose", meaning: "Decreased Love", opposite: "Deepening Love", color: "#EAB308", image: "flower/yellow-rose.jpg" },
            "Chaste": { name: "Acacia", meaning: "Chaste Love", opposite: "Impure Love", color: "#EAB308", image: "flower/yellow-acacia.jpg" },
            "Marriage": { name: "Myrtle", meaning: "Love in Marriage", opposite: "Divorce", color: "#059669", image: "flower/myrtle.jpg" },
            "Declaration of": { name: "Red Tulip", meaning: "Declaration of Love", opposite: "Concealment of Love", color: "#EF4444", image: "flower/red-tulip.jpg" },
            "Eternal": { name: "Bay Leaf", meaning: "Eternal Love", opposite: "Temporary Love", color: "#14532D", image: "flower/bay-leaf.jpg" },
            "Sympathy": { name: "Balm", meaning: "Sympathy", opposite: "Callousness", color: "#818CF8", image: "flower/balm.jpg" },
            "Sad": { name: "Purple Hyacinth", meaning: "Sorrow / I am sorry", opposite: "Celebration", color: "#6D28D9", image: "flower/purple-hyacinth.jpg" },
            "I'm sorry": { name: "Purple Hyacinth", meaning: "I am sorry", opposite: "No Regret", color: "#6D28D9", image: "flower/purple-hyacinth.jpg" },
            "Cruelty": { name: "Marigold", meaning: "Cruelty", opposite: "Kindness", color: "#F59E0B", image: "flower/marigold.jpg" },
            "Forsaken": { name: "Zephyr Flower", meaning: "Forsaken", opposite: "Cherished", color: "#64748B", image: "flower/zephyr-flower.jpg" },
            "Sickness": { name: "Zephyr Flower", meaning: "Sickness", opposite: "Health", color: "#64748B", image: "flower/zephyr-flower.jpg" },
            "Miss friend": { name: "Zinnia", meaning: "Missing a Friend", opposite: "Friend Present", color: "#EC4899", image: "flower/zinnia.jpg" },
            "Painful recollections": { name: "Adonis (Flos)", meaning: "Painful Recollections", opposite: "Pleasant Memories", color: "#EF4444", image: "flower/adonis.jpg" },
            "Alas! for my poor heart": { name: "Carnation (Red)", meaning: "Alas! for my poor heart", opposite: "Joyful Heart", color: "#EF4444", image: "flower/carnation-red.jpg" },
            "Consolation": { name: "Poppy (Red)", meaning: "Consolation", opposite: "Despair", color: "#EF4444", image: "flower/poppy-red.jpg" },
            "Remembrance": { name: "Rosemary", meaning: "Remembrance", opposite: "Forgetfulness", color: "#059669", image: "flower/rosemary.jpg" },
            "Departure": { name: "Sweet Pea", meaning: "Departure", opposite: "Arrival", color: "#EC4899", image: "flower/sweat-pea.jpg" },
            "Lonely": { name: "Asphodel", meaning: "My regrets follow you to the grave", opposite: "New Beginnings", color: "#64748B", image: "flower/asphodel.jpg" },
            "Grieved": { name: "Aloe", meaning: "Grief", opposite: "Consolation", color: "#166534", image: "flower/aloe.jpg" },
            "Angry": { name: "Basil", meaning: "Hatred", opposite: "Benevolence", color: "#7F1D1D", image: "flower/basil.jpg" },
            "Hatred": { name: "Basil", meaning: "Hatred", opposite: "Benevolence", color: "#7F1D1D", image: "flower/basil.jpg" },
            "Jealousy": { name: "Yellow Rose", meaning: "Jealousy", opposite: "Trust", color: "#EAB308", image: "flower/yellow-rose.jpg" },
            "Frustrated": { name: "Hydrangea", meaning: "Heartlessness", opposite: "Warmth", color: "#BFDBFE", image: "flower/hydrangea.jpg" },
            "Heartlessness": { name: "Hydrangea", meaning: "Heartlessness", opposite: "Warmth", color: "#BFDBFE", image: "flower/hydrangea.jpg" },
            "Disdain": { name: "Yellow Carnation", meaning: "Disdain", opposite: "Respect", color: "#EAB308", image: "flower/yellow-carnation.jpg" },
            "Ingratitude": { name: "Buttercup", meaning: "Ingratitude", opposite: "Gratitude", color: "#FEF08A", image: "flower/buttercup.jpg" },
            "Fickleness": { name: "Pink Larkspur", meaning: "Fickleness", opposite: "Constancy", color: "#EC4899", image: "flower/larkspur-pink.jpg" },
            "Stupidity": { name: "Almond", meaning: "Stupidity", opposite: "Wisdom", color: "#FCE7F3", image: "flower/almond.jpg" },
            "Bluntness": { name: "Borage", meaning: "Bluntness", opposite: "Tact", color: "#3B82F6", image: "flower/borage.jpg" },
            "Refusal": { name: "Carnation (Striped)", meaning: "Refusal", opposite: "Acceptance", color: "#EC4899", image: "flower/carnation-striped.jpg" },
            "Scared": { name: "Lavender", meaning: "Distrust", opposite: "Confidence", color: "#C4B5FD", image: "flower/lavender.jpg" },
            "Distrust": { name: "Lavender", meaning: "Distrust", opposite: "Confidence", color: "#C4B5FD", image: "flower/lavender.jpg" },
            "Indiscretion": { name: "Common Almond", meaning: "Indiscretion", opposite: "Discretion", color: "#FCE7F3", image: "flower/common-almond.jpg" },
            "Timidity": { name: "Amaryllis", meaning: "Timidity", opposite: "Boldness", color: "#EF4444", image: "flower/amaryllis.jpg" },
            "Bashfulness": { name: "Peony", meaning: "Bashfulness", opposite: "Boldness", color: "#EC4899", image: "flower/peony.jpg" },
            "Pride": { name: "Amaryllis", meaning: "Pride", opposite: "Humility", color: "#EF4444", image: "flower/amaryllis.jpg" },
            "Silence": { name: "Belladonna", meaning: "Silence", opposite: "Noise", color: "#6B7280", image: "flower/belladonna.jpg" },
            "Anxious": { name: "Red Columbine", meaning: "Anxiety", opposite: "Serenity", color: "#F87171", image: "flower/red-columbine.jpg" },
            "Instability": { name: "Dhalia", meaning: "Instability", opposite: "Stability", color: "#FB923C", image: "flower/dhalia.jpg" },
            "Amazed": { name: "Angelica", meaning: "Inspiration", opposite: "Dullness", color: "#D1FAE5", image: "flower/angelica.jpg" },
            "Surprised": { name: "Truffle", meaning: "Surprise", opposite: "Expectation", color: "#78350F", image: "flower/truffle.jpg" },
            "Fascination": { name: "Fern", meaning: "Fascination", opposite: "Boredom", color: "#059669", image: "flower/fern.jpg" },
            "Magic": { name: "Fern", meaning: "Magic", opposite: "Mundanity", color: "#059669", image: "flower/fern.jpg" },
            "Ardor": { name: "Arum", meaning: "Ardor", opposite: "Apathy", color: "#EF4444", image: "flower/arum.jpg" },
            "Afterthought": { name: "China Aster", meaning: "Afterthought", opposite: "Forethought", color: "#A855F7", image: "flower/china-aster.jpg" },
            "Precaution": { name: "Goldenrod", meaning: "Precaution", opposite: "Recklessness", color: "#EAB308", image: "flower/goldenrod.jpg" },
            "Shame": { name: "Peony", meaning: "Shame", opposite: "Confidence", color: "#EC4899", image: "flower/peony.jpg" },
            "Artifice": { name: "Acanthus", meaning: "Artifice", opposite: "Sincerity", color: "#059669", image: "flower/acanthus.jpg" },
            "Rustic oracle": { name: "Dandelion", meaning: "Rustic Oracle", opposite: "Urban Wisdom", color: "#FEF08A", image: "flower/dandelion.jpg" },
            "Poetry": { name: "Eglantine", meaning: "Poetry", opposite: "Prose", color: "#EC4899", image: "flower/eglantine.jpg" },
            "Insincerity": { name: "Foxglove", meaning: "Insincerity", opposite: "Sincerity", color: "#A855F7", image: "flower/foxglove.jpg" },
            "Message": { name: "Iris", meaning: "Message", opposite: "Silence", color: "#6366F1", image: "flower/iris.jpg" },
            "Egotism": { name: "Narcissus", meaning: "Egotism", opposite: "Humility", color: "#FEF08A", image: "flower/narcissus.jpg" },
            "Thoughts": { name: "Pansy", meaning: "Thoughts", opposite: "Thoughtlessness", color: "#A855F7", image: "flower/pansy.jpg" }
        };

        const EMOTION_WHEEL = [
            { label: "Joy", color: "emerald-400", sub: ["Joyful", "Content", "Optimistic", "Peaceful", "Hope", "Innocence", "Gladness", "Purity", "Friendship", "Childishness", "Elegance", "Temperance", "Constancy", "Fidelity", "Mental beauty", "Preference", "Amiability", "Humility", "Incorruptible", "Steadfast piety", "Neatness", "Modesty", "Youthfulness", "Sweetness", "Candor"] },
            { label: "Love", color: "amber-300", sub: ["Enchanted", "Sentimental", "Compassionate", "Grateful", "Deep", "Returned", "Passionate", "Loyal", "Secret", "Affection", "Generous", "Devoted", "Faithfulness", "True", "Don't forget me", "Slighted", "I love", "Unequalled", "First", "Decreased", "Chaste", "Marriage", "Declaration of", "Eternal", "Sympathy", "Loveliness", "Acknowledgment", "Constant", "Fidelity", "I am worthy", "Celibacy"] },
            { label: "Sadness", color: "sky-400", sub: ["Sad", "Lonely", "Grieved", "I'm sorry", "Cruelty", "Forsaken", "Sickness", "Miss friend", "Painful recollections", "Alas! for my poor heart", "Consolation", "Remembrance", "Departure"] },
            { label: "Anger", color: "rose-500", sub: ["Angry", "Jealousy", "Frustrated", "Hatred", "Heartlessness", "Disdain", "Ingratitude", "Fickleness", "Stupidity", "Bluntness", "Refusal"] },
            { label: "Fear", color: "orange-400", sub: ["Scared", "Anxious", "Instability", "Distrust", "Indiscretion", "Timidity", "Bashfulness", "Pride", "Silence", "Precaution", "Shame"] },
            { label: "Surprise", color: "cyan-400", sub: ["Amazed", "Surprised", "Fascination", "Ardor", "Afterthought", "Magic", "Artifice", "Truth", "Rustic oracle", "Poetry", "Insincerity", "Message", "Egotism", "Thoughts"] },
        ];

        let state = {
            selectedEmotions: [],
            activeCategory: null,
            nuance: 'Upright'
        };

        function toggleModal() {
            const modal = document.getElementById('modal');
            modal.classList.toggle('hidden');
        }

        function init() {
            renderCategories();
            renderModality();
            updateBouquet();
        }

        function renderCategories() {
            const container = document.getElementById('emotion-wheel-container');
            const radius = 140; // Distance from center
            const centerX = 160; // Half of 320px container width
            const centerY = 160; // Half of 320px container height
            const angleStep = (2 * Math.PI) / EMOTION_WHEEL.length; // 60 degrees in radians
            
            // Color mapping for Tailwind classes
            const colorMap = {
                "emerald-400": "#34d399",
                "amber-300": "#fcd34d",
                "sky-400": "#38bdf8",
                "rose-500": "#f43f5e",
                "orange-400": "#fb923c",
                "cyan-400": "#22d3ee"
            };
            
            const buttonsHTML = EMOTION_WHEEL.map((cat, index) => {
                const angle = index * angleStep - Math.PI / 2; // Start from top (-90 degrees)
                const x = centerX + radius * Math.cos(angle) - 64; // Offset by half button width (128/2)
                const y = centerY + radius * Math.sin(angle) - 64; // Offset by half button height (128/2)
                const bgColor = colorMap[cat.color] || "#6b7280";
                const isActive = state.activeCategory === cat.label;
                
                const labelKey = cat.label.toLowerCase();
                const translatedLabel = t(labelKey) || cat.label;
                return `
                    <button 
                        onclick="selectCategory('${cat.label}')" 
                        id="cat-${cat.label}" 
                        class="emotion-wheel-item p-6 rounded-full transition-all border-4 font-bold font-sans text-base border-white hover:border-white hover:shadow-2xl text-white w-32 h-32 flex items-center justify-center ${isActive ? 'ring-8 ring-stone-100 scale-110' : ''}"
                        style="left: ${x}px; top: ${y}px; background-color: ${bgColor};"
                    >
                        ${translatedLabel}
                    </button>
                `;
            }).join('');
            
            // Add Consult button in the center
            const consultButtonSize = 80; // Smaller than emotion buttons
            const consultX = centerX - consultButtonSize / 2;
            const consultY = centerY - consultButtonSize / 2;
            
            container.innerHTML = buttonsHTML + `
                <button 
                    onclick="toggleModal()" 
                    id="consult-button" 
                    class="emotion-wheel-item rounded-full transition-all border-4 font-bold font-sans text-sm border-stone-300 hover:border-stone-400 hover:shadow-2xl text-stone-800 bg-stone-100 hover:bg-stone-200 w-20 h-20 flex items-center justify-center absolute z-10"
                    style="left: ${consultX}px; top: ${consultY}px;"
                >
                    ${t('consult')}
                </button>
            `;
        }

        function selectCategory(label) {
            state.activeCategory = state.activeCategory === label ? null : label;
            
            // Re-render categories to update active state
            renderCategories();

            const subContainer = document.getElementById('sub-emotions');
            if (state.activeCategory) {
                subContainer.classList.remove('hidden');
                renderSubEmotions();
            } else {
                subContainer.classList.add('hidden');
            }
        }

        function lightenColor(hex, percent) {
            // Remove # if present
            hex = hex.replace('#', '');
            // Convert to RGB
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            // Lighten by blending with white
            const newR = Math.round(r + (255 - r) * percent);
            const newG = Math.round(g + (255 - g) * percent);
            const newB = Math.round(b + (255 - b) * percent);
            // Convert back to hex
            return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;
        }

        function renderSubEmotions() {
            const cat = EMOTION_WHEEL.find(c => c.label === state.activeCategory);
            const list = document.getElementById('sub-emotion-list');
            
            // Get the category color
            const colorMap = {
                "emerald-400": "#34d399",
                "amber-300": "#fcd34d",
                "sky-400": "#38bdf8",
                "rose-500": "#f43f5e",
                "orange-400": "#fb923c",
                "cyan-400": "#22d3ee"
            };
            const categoryColor = colorMap[cat.color] || "#6b7280";
            const lighterColor = lightenColor(categoryColor, 0.85); // Lighten by 85%
            
            list.innerHTML = cat.sub.map(sub => {
                const flower = FLORAL_DICTIONARY[sub];
                const isSelected = state.selectedEmotions.includes(sub);
                // Use data attributes to avoid escaping issues with apostrophes
                return `
                    <button 
                        data-emotion="${sub.replace(/"/g, '&quot;')}"
                        class="emotion-btn px-8 py-4 rounded-full text-base font-sans font-bold transition-all border ${isSelected ? 'text-white border-white shadow-2xl scale-110' : 'text-stone-700 border-stone-300 hover:border-stone-400'}"
                        style="background-color: ${isSelected ? categoryColor : lighterColor};">
                        ${sub}
                    </button>
                `;
            }).join('');
            
            // Add event listeners to all emotion buttons
            list.querySelectorAll('.emotion-btn').forEach(btn => {
                const emotion = btn.getAttribute('data-emotion');
                btn.addEventListener('click', () => toggleEmotion(emotion));
                btn.addEventListener('mouseenter', (e) => showFlowerPreview(e, emotion));
                btn.addEventListener('mouseleave', hideFlowerPreview);
            });
        }

        function showFlowerPreview(event, emotion) {
            const flower = FLORAL_DICTIONARY[emotion];
            if (!flower) return;
            
            const preview = document.getElementById('flower-preview');
            const previewImage = document.getElementById('preview-image');
            const previewName = document.getElementById('preview-name');
            const previewMeaning = document.getElementById('preview-meaning');
            
            previewImage.src = flower.image;
            previewImage.alt = flower.name;
            previewName.textContent = flower.name;
            previewMeaning.textContent = flower.meaning;
            
            preview.classList.remove('hidden');
            
            // Position the preview relative to the button
            const button = event.currentTarget;
            const buttonRect = button.getBoundingClientRect();
            const containerRect = document.getElementById('sub-emotions').getBoundingClientRect();
            
            // Position to the right of the button, or left if there's no space
            const spaceRight = window.innerWidth - buttonRect.right;
            const spaceLeft = buttonRect.left;
            
            if (spaceRight >= 250) {
                preview.style.left = `${buttonRect.right - containerRect.left + 16}px`;
                preview.style.top = `${buttonRect.top - containerRect.top}px`;
            } else if (spaceLeft >= 250) {
                preview.style.left = `${buttonRect.left - containerRect.left - 220}px`;
                preview.style.top = `${buttonRect.top - containerRect.top}px`;
            } else {
                // Center it above or below
                preview.style.left = `${buttonRect.left - containerRect.left + (buttonRect.width / 2) - 100}px`;
                preview.style.top = `${buttonRect.bottom - containerRect.top + 16}px`;
            }
        }

        function hideFlowerPreview() {
            const preview = document.getElementById('flower-preview');
            preview.classList.add('hidden');
        }

        function toggleEmotion(emo) {
            if (state.selectedEmotions.includes(emo)) {
                state.selectedEmotions = state.selectedEmotions.filter(e => e !== emo);
            } else {
                state.selectedEmotions.push(emo);
            }
            renderSubEmotions();
            updateBouquet();
        }

        function renderModality() {
            const modes = [
                { id: "Upright", labelKey: "upright", descKey: "classicMeaning" },
                { id: "Inverted", labelKey: "inverted", descKey: "oppositeSpirit" },
                { id: "Left", labelKey: "left", descKey: "fromGiver" },
                { id: "Right", labelKey: "right", descKey: "toReceiver" }
            ];
            const container = document.getElementById('modality-controls');
            container.innerHTML = modes.map(m => `
                <button onclick="setNuance('${m.id}')" id="mode-${m.id}" class="flex flex-col gap-4 p-6 rounded-2xl border-2 transition-all text-left ${state.nuance === m.id ? 'border-amber-400 bg-amber-500/20 text-amber-200 shadow-2xl' : 'border-white/20 bg-white/5 text-stone-300 hover:bg-white/10 hover:border-white/30'}">
                    <div class="text-sm font-black uppercase tracking-widest leading-none mb-1 font-sans">${t(m.labelKey)}</div>
                    <div class="text-xs font-medium opacity-70 font-sans">${t(m.descKey)}</div>
                </button>
            `).join('');
        }

        function setNuance(n) {
            state.nuance = n;
            renderModality();
            updateBouquet();
        }

        function updateBouquet() {
            const empty = document.getElementById('empty-state');
            const active = document.getElementById('active-state');
            const field = document.getElementById('floral-field');
            const synthesis = document.getElementById('synthesis-text');
            const dict = document.getElementById('dictionary-entries');
            const badge = document.getElementById('mode-badge');

            if (state.selectedEmotions.length === 0) {
                empty.classList.remove('hidden');
                active.classList.add('hidden');
                dict.innerHTML = '';
                return;
            }

            empty.classList.add('hidden');
            active.classList.remove('hidden');
            const nuanceKey = state.nuance.toLowerCase();
            badge.innerText = `${t('mode')}: ${t(nuanceKey)}`;

            const bouquet = state.selectedEmotions.map(e => ({ emotion: e, ...FLORAL_DICTIONARY[e] }));
            
            // Render Visual Bouquet
            field.innerHTML = bouquet.map((f, i) => `
                <div class="animate-in zoom-in fade-in duration-700 flower-${state.nuance.toLowerCase()}" style="animation-delay: ${i * 100}ms">
                    <div class="w-32 h-32 md:w-48 md:h-48 rounded-full overflow-hidden border-4 border-white shadow-2xl">
                        <img src="${f.image}" class="w-full h-full object-cover">
                    </div>
                </div>
            `).join('');

            // Render Synthesis Text
            const meanings = bouquet.map(f => state.nuance === 'Inverted' ? f.opposite.toLowerCase() : f.meaning.toLowerCase());
            const stemText = bouquet.length === 1 ? t('stem') : t('stems');
            synthesis.innerText = `"${t('bouquetOf')} ${bouquet.length} ${stemText} ${t('signifying')} ${meanings.join(', ')}."`;

            // Render Cards
            dict.innerHTML = bouquet.map(f => `
                <div class="bg-white p-10 rounded-[2.5rem] border border-stone-200/60 shadow-xl flex flex-col gap-8">
                    <div class="flex items-center justify-between">
                        <div class="w-24 h-24 rounded-3xl overflow-hidden shadow-inner bg-stone-100">
                            <img src="${f.image}" class="w-full h-full object-cover">
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-stone-400 font-black uppercase tracking-widest font-sans mb-2">${f.emotion}</p>
                            <p class="text-2xl font-bold text-stone-800">${f.name}</p>
                        </div>
                    </div>
                    <div class="pt-6 border-t border-stone-100 flex justify-between">
                        <div>
                            <p class="text-[11px] font-black uppercase tracking-widest text-stone-400 font-sans">${t('meaning')}</p>
                            <p class="text-stone-800 font-bold">${f.meaning}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[11px] font-black uppercase tracking-widest text-rose-400 font-sans">${t('opposite')}</p>
                            <p class="text-rose-600 font-bold italic">${f.opposite}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function consultBouquet() {
            // Scroll to the bouquet section
            const bouquetSection = document.getElementById('active-state');
            if (bouquetSection && !bouquetSection.classList.contains('hidden')) {
                bouquetSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                // If no bouquet yet, scroll to the empty state or show a message
                const emptyState = document.getElementById('empty-state');
                if (emptyState) {
                    emptyState.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        window.onload = function() {
            // Initialize the application on page load
            init();
        };
    </script>
</body>
</html>